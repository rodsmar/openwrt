From 615af047639896e1d92edf7c18322a1a6d993e92 Mon Sep 17 00:00:00 2001
From: Evelyn Tsai <evelyn.tsai@mediatek.com>
Date: Fri, 14 Oct 2022 11:15:13 +0800
Subject: [PATCH 1021/1051] wifi: mt76: mt7915: support on off SW ACI through
 debugfs

Signed-off-by: Evelyn Tsai <evelyn.tsai@mediatek.com>
---
 mt76_connac_mcu.h    |  1 +
 mt7915/mtk_debugfs.c | 21 +++++++++++++++++++++
 2 files changed, 22 insertions(+)

--- a/mt76_connac_mcu.h
+++ b/mt76_connac_mcu.h
@@ -1280,6 +1280,7 @@ enum {
 	MCU_EXT_CMD_SET_CFG = 0xb7,
 	MCU_EXT_CMD_EDCCA = 0xba,
 	MCU_EXT_CMD_WF_RF_PIN_CTRL = 0xbd,
+	MCU_EXT_CMD_SWLNA_ACI_CTRL = 0xc0,
 	MCU_EXT_CMD_CSI_CTRL = 0xc2,
 	MCU_EXT_CMD_IPI_HIST_SCAN = 0xc5,
 };
--- a/mt7915/mtk_debugfs.c
+++ b/mt7915/mtk_debugfs.c
@@ -3770,6 +3770,25 @@ static int mt7915_show_eeprom_mode(struc
 	return 0;
 }
 
+static int
+mt7915_sw_aci_set(void *data, u64 val)
+{
+#define SWLNA_ENABLE 6
+	struct mt7915_dev *dev = data;
+	struct {
+		u32 subcmd;
+		u8 enable;
+	} req = {
+		.subcmd = SWLNA_ENABLE,
+		.enable = (u8) val,
+	};
+	return mt76_mcu_send_msg(&dev->mt76, MCU_EXT_CMD(SWLNA_ACI_CTRL), &req, sizeof(req), NULL);
+}
+
+
+DEFINE_DEBUGFS_ATTRIBUTE(fops_sw_aci, NULL,
+			 mt7915_sw_aci_set, "%llx\n");
+
 int mt7915_mtk_init_debugfs(struct mt7915_phy *phy, struct dentry *dir)
 {
 	struct mt7915_dev *dev = phy->dev;
@@ -3855,6 +3874,9 @@ int mt7915_mtk_init_debugfs(struct mt791
 			    &fops_txbf_sta_rec);
 
 	debugfs_create_u8("sku_disable", 0600, dir, &dev->dbg.sku_disable);
+	
+	debugfs_create_file("sw_aci", 0600, dir, dev,
+			    &fops_sw_aci);
 
 	debugfs_create_devm_seqfile(dev->mt76.dev, "eeprom_mode", dir,
 				    mt7915_show_eeprom_mode);
